"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.CheckboxWithoutAnalytics = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _analyticsNext = require("@atlaskit/analytics-next");

var _styledComponents = require("styled-components");

var _CheckboxIcon = _interopRequireDefault(require("./CheckboxIcon"));

var _package = require("../package.json");

var _Checkbox = require("./styled/Checkbox");

var emptyTheme = {};

var Checkbox =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2.default)(Checkbox, _Component);

  function Checkbox() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2.default)(this, Checkbox);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(Checkbox)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "state", {
      isActive: false,
      isFocused: false,
      isHovered: false,
      isMouseDown: false,
      isChecked: _this.props.isChecked !== undefined ? _this.props.isChecked : _this.props.defaultChecked
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "checkbox", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "actionKeys", [' ']);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "getProp", function (key) {
      return key in _this.props ? _this.props[key] : _this.state[key];
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onChange", function (event) {
      if (_this.props.isDisabled) return null;
      event.persist();

      if (event.target.checked !== undefined) {
        _this.setState({
          isChecked: event.target.checked
        });
      }

      if (_this.props.onChange) {
        _this.props.onChange(event);
      }

      return true;
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "blur", function () {
      if (_this.checkbox && _this.checkbox.blur) _this.checkbox.blur();
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "focus", function () {
      if (_this.checkbox && _this.checkbox.focus) _this.checkbox.focus();
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onBlur", function () {
      return _this.setState({
        // onBlur is called after onMouseDown if the checkbox was focused, however
        // in this case on blur is called immediately after, and we need to check
        // whether the mouse is down.
        isActive: _this.state.isMouseDown && _this.state.isActive,
        isFocused: false
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onFocus", function () {
      return _this.setState({
        isFocused: true
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onMouseLeave", function () {
      return _this.setState({
        isActive: false,
        isHovered: false
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onMouseEnter", function () {
      return _this.setState({
        isHovered: true
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onMouseUp", function () {
      return _this.setState({
        isActive: false,
        isMouseDown: false
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onMouseDown", function () {
      return _this.setState({
        isActive: true,
        isMouseDown: true
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onKeyDown", function (event) {
      if (_this.actionKeys.includes(event.key)) {
        _this.setState({
          isActive: true
        });
      }
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onKeyUp", function (event) {
      if (_this.actionKeys.includes(event.key)) {
        _this.setState({
          isActive: false
        });
      }
    });
    return _this;
  }

  (0, _createClass2.default)(Checkbox, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var isIndeterminate = this.props.isIndeterminate; // there is no HTML attribute for indeterminate, and thus no prop equivalent.
      // it must be set via the ref.

      if (this.checkbox) {
        this.checkbox.indeterminate = !!isIndeterminate;

        if (this.props.inputRef) {
          this.props.inputRef(this.checkbox);
        }
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      var isIndeterminate = this.props.isIndeterminate;

      if (prevProps.isIndeterminate !== isIndeterminate && this.checkbox) {
        this.checkbox.indeterminate = !!isIndeterminate;
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          isDisabled = _this$props.isDisabled,
          isInvalid = _this$props.isInvalid,
          isIndeterminate = _this$props.isIndeterminate,
          label = _this$props.label,
          name = _this$props.name,
          value = _this$props.value,
          onChange = _this$props.onChange,
          props = (0, _objectWithoutProperties2.default)(_this$props, ["isDisabled", "isInvalid", "isIndeterminate", "label", "name", "value", "onChange"]);
      var isChecked = this.getProp('isChecked');
      var _this$state = this.state,
          isFocused = _this$state.isFocused,
          isActive = _this$state.isActive,
          isHovered = _this$state.isHovered;
      return _react.default.createElement(_styledComponents.ThemeProvider, {
        theme: emptyTheme
      }, _react.default.createElement(_Checkbox.Label, (0, _extends2.default)({}, props, {
        isDisabled: isDisabled,
        onMouseDown: this.onMouseDown,
        onMouseEnter: this.onMouseEnter,
        onMouseLeave: this.onMouseLeave,
        onMouseUp: this.onMouseUp
      }), _react.default.createElement(_Checkbox.CheckboxWrapper, null, _react.default.createElement(_Checkbox.HiddenCheckbox, {
        disabled: isDisabled,
        checked: isChecked,
        onChange: this.onChange,
        onBlur: this.onBlur,
        onFocus: this.onFocus,
        onKeyUp: this.onKeyUp,
        onKeyDown: this.onKeyDown,
        type: "checkbox",
        value: value,
        name: name,
        innerRef: function innerRef(r) {
          return _this2.checkbox = r;
        } // eslint-disable-line

      }), _react.default.createElement(_CheckboxIcon.default, {
        isChecked: isChecked,
        isDisabled: isDisabled,
        isFocused: isFocused,
        isActive: isActive,
        isHovered: isHovered,
        isInvalid: isInvalid,
        isIndeterminate: isIndeterminate,
        primaryColor: "inherit",
        secondaryColor: "inherit",
        label: ""
      })), _react.default.createElement(_Checkbox.LabelText, null, label)));
    }
  }]);
  return Checkbox;
}(_react.Component);

exports.CheckboxWithoutAnalytics = Checkbox;
(0, _defineProperty2.default)(Checkbox, "defaultProps", {
  isDisabled: false,
  isInvalid: false,
  defaultChecked: false,
  isIndeterminate: false
});
var createAndFireEventOnAtlaskit = (0, _analyticsNext.createAndFireEvent)('atlaskit');

var _default = (0, _analyticsNext.withAnalyticsContext)({
  componentName: 'checkbox',
  packageName: _package.name,
  packageVersion: _package.version
})((0, _analyticsNext.withAnalyticsEvents)({
  onChange: createAndFireEventOnAtlaskit({
    action: 'changed',
    actionSubject: 'checkbox',
    attributes: {
      componentName: 'checkbox',
      packageName: _package.name,
      packageVersion: _package.version
    }
  })
})(Checkbox));

exports.default = _default;