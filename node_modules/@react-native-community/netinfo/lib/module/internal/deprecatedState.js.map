{"version":3,"sources":["deprecatedState.ts"],"names":["State","DeprecatedUtils","_isSetup","_subscriptions","Set","_latestState","_handler","state","convertedState","convertState","forEach","handler","setup","add","tearDown","remove","clear","latest","Promise","resolve","then","delete"],"mappings":"AASA,MAAOA,CAAAA,KAAP,KAAkB,SAAlB,CAGA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CAEA,GAAIC,CAAAA,QAAQ,CAAG,KAAf,CACA,GAAMC,CAAAA,cAAc,CAAG,GAAIC,CAAAA,GAAJ,EAAvB,CACA,GAAIC,CAAAA,YAAgD,CAAG,IAAvD,CAEA,QAASC,CAAAA,QAAT,CAAkBC,KAAlB,CAAmD,CACjD,GAAMC,CAAAA,cAAc,CAAGP,eAAe,CAACQ,YAAhB,CAA6BF,KAA7B,CAAvB,CACAF,YAAY,CAAGG,cAAf,CACAL,cAAc,CAACO,OAAf,CAAuB,SAACC,OAAD,QAAmBA,CAAAA,OAAO,CAACH,cAAD,CAA1B,EAAvB,EACD,CAED,MAAO,SAASI,CAAAA,KAAT,EAAuB,CAE5B,GAAIV,QAAJ,CAAc,CACZ,OACD,CAEDF,KAAK,CAACa,GAAN,CAAUP,QAAV,EACD,CAED,MAAO,SAASQ,CAAAA,QAAT,EAA0B,CAE/B,GAAI,CAACZ,QAAL,CAAe,CACb,OACD,CAEDF,KAAK,CAACe,MAAN,CAAaT,QAAb,EACAD,YAAY,CAAG,IAAf,CACAF,cAAc,CAACa,KAAf,GACD,CAED,MAAO,SAASC,CAAAA,MAAT,EAAwD,CAC7D,GAAIZ,YAAJ,CAAkB,CAChB,MAAOa,CAAAA,OAAO,CAACC,OAAR,CAAgBd,YAAhB,CAAP,CACD,CAFD,IAEO,CACL,MAAOL,CAAAA,KAAK,CAACiB,MAAN,GAAeG,IAAf,CACL,SAACb,KAAD,CAAwC,CACtCF,YAAY,CAAGJ,eAAe,CAACQ,YAAhB,CAA6BF,KAA7B,CAAf,CACA,MAAOF,CAAAA,YAAP,CACD,CAJI,CAAP,CAMD,CACF,CAED,MAAO,SAASQ,CAAAA,GAAT,CAAaF,OAAb,CAA2D,CAEhER,cAAc,CAACU,GAAf,CAAmBF,OAAnB,EAGA,GAAIN,YAAJ,CAAkB,CAChBM,OAAO,CAACN,YAAD,CAAP,CACD,CAFD,IAEO,CACLY,MAAM,GAAGG,IAAT,CAAcT,OAAd,EACD,CACF,CAED,MAAO,SAASI,CAAAA,MAAT,CAAgBJ,OAAhB,CAA8D,CACnER,cAAc,CAACkB,MAAf,CAAsBV,OAAtB,EACD,CAED,cAAe,CACbC,KAAK,CAALA,KADa,CAEbE,QAAQ,CAARA,QAFa,CAGbG,MAAM,CAANA,MAHa,CAIbJ,GAAG,CAAHA,GAJa,CAKbE,MAAM,CAANA,MALa,CAAf","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n */\n\nimport State from './state';\nimport * as DeprecatedTypes from './deprecatedTypes';\nimport * as Types from './types';\nimport DeprecatedUtils from './deprecatedUtils';\n\nlet _isSetup = false;\nconst _subscriptions = new Set<DeprecatedTypes.ChangeHandler>();\nlet _latestState: DeprecatedTypes.NetInfoData | null = null;\n\nfunction _handler(state: Types.NetInfoState): void {\n  const convertedState = DeprecatedUtils.convertState(state);\n  _latestState = convertedState;\n  _subscriptions.forEach((handler): void => handler(convertedState));\n}\n\nexport function setup(): void {\n  // Skip if we are already setup\n  if (_isSetup) {\n    return;\n  }\n\n  State.add(_handler);\n}\n\nexport function tearDown(): void {\n  // Skip if we are not setup\n  if (!_isSetup) {\n    return;\n  }\n\n  State.remove(_handler);\n  _latestState = null;\n  _subscriptions.clear();\n}\n\nexport function latest(): Promise<DeprecatedTypes.NetInfoData> {\n  if (_latestState) {\n    return Promise.resolve(_latestState);\n  } else {\n    return State.latest().then(\n      (state): DeprecatedTypes.NetInfoData => {\n        _latestState = DeprecatedUtils.convertState(state);\n        return _latestState;\n      },\n    );\n  }\n}\n\nexport function add(handler: DeprecatedTypes.ChangeHandler): void {\n  // Add the subscription handler to our set\n  _subscriptions.add(handler);\n\n  // Send the latest state we have on listen\n  if (_latestState) {\n    handler(_latestState);\n  } else {\n    latest().then(handler);\n  }\n}\n\nexport function remove(handler: DeprecatedTypes.ChangeHandler): void {\n  _subscriptions.delete(handler);\n}\n\nexport default {\n  setup,\n  tearDown,\n  latest,\n  add,\n  remove,\n};\n"]}