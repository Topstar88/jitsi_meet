!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self)["final-form"]={})}(this,function(e){"use strict";function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var o=function(e){if(null==e||!e.length)return[];if("string"!=typeof e)throw new Error("toPath() expects a string");return e.split(/[.[\]]+/).filter(Boolean)},R=function(e,t){for(var i=o(t),r=e,n=0;n<i.length;n++){var a=i[n];if(null==r||"object"!=typeof r||Array.isArray(r)&&isNaN(a))return;r=r[a]}return r};function h(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof t?t:String(t)}var n=function e(t,i,r,n,a){if(i>=r.length)return n;var o=r[i];if(isNaN(o)){var u;if(null==t){var s,l=e(void 0,i+1,r,n,a);return void 0===l?void 0:((s={})[o]=l,s)}if(Array.isArray(t))throw new Error("Cannot set a non-numeric property on an array");var f=e(t[o],i+1,r,n,a),d=Object.keys(t).length;if(void 0!==f)return N({},t,((u={})[o]=f,u));if(void 0===t[o]&&0===d)return;if(void 0!==t[o]&&d<=1)return isNaN(r[i-1])||a?void 0:{};t[o];return function(e,t){if(null==e)return{};var i,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++)i=a[r],0<=t.indexOf(i)||(n[i]=e[i]);return n}(t,[o].map(h))}var c=Number(o);if(null==t){var v=e(void 0,i+1,r,n,a);if(void 0===v)return;var b=[];return b[c]=v,b}if(!Array.isArray(t))throw new Error("Cannot set a numeric property on an object");var m=e(t[c],i+1,r,n,a),S=[].concat(t);if(a&&void 0===m){if(S.splice(c,1),0===S.length)return}else S[c]=m;return S},A=function(e,t,i,r){if(void 0===r&&(r=!1),null==e)throw new Error("Cannot call setIn() with "+String(e)+" state");if(null==t)throw new Error("Cannot call setIn() with "+String(t)+" key");return n(e,0,o(t),i,r)},x="FINAL_FORM/form-error",I="FINAL_FORM/array-error",P=function(e,t){var i=e.errors,r=e.initialValues,n=e.lastSubmittedValues,a=e.submitErrors,o=e.submitFailed,u=e.submitSucceeded,s=e.submitting,l=e.values,f=t.active,d=t.blur,c=t.change,v=t.data,b=t.focus,m=t.modified,S=t.name,h=t.touched,y=t.visited,g=R(l,S),p=R(i,S);p&&p[I]&&(p=p[I]);var E=a&&R(a,S),F=r&&R(r,S),O=t.isEqual(F,g),w=!p&&!E;return{active:f,blur:d,change:c,data:v,dirty:!O,dirtySinceLastSubmit:!(!n||t.isEqual(R(n,S),g)),error:p,focus:b,initial:F,invalid:!w,length:Array.isArray(g)?g.length:void 0,modified:m,name:S,pristine:O,submitError:E,submitFailed:o,submitSucceeded:u,submitting:s,touched:h,valid:w,value:g,visited:y}},a=["active","data","dirty","dirtySinceLastSubmit","error","initial","invalid","length","modified","pristine","submitError","submitFailed","submitSucceeded","submitting","touched","valid","value","visited"],L=function(e,t){if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(var n=Object.prototype.hasOwnProperty.bind(t),a=0;a<i.length;a++){var o=i[a];if(!n(o)||e[o]!==t[o])return!1}return!0};function u(t,i,r,n,e,a){var o=!1;return e.forEach(function(e){n[e]&&(t[e]=i[e],r&&(~a.indexOf(e)?L(i[e],r[e]):i[e]===r[e])||(o=!0))}),o}var s=["data"],q=function(e,t,i,r){var n={blur:e.blur,change:e.change,focus:e.focus,name:e.name};return u(n,e,t,i,a,s)||!t||r?n:void 0},l=["active","dirty","dirtyFields","dirtySinceLastSubmit","error","errors","hasSubmitErrors","hasValidationErrors","initialValues","invalid","modified","pristine","submitting","submitError","submitErrors","submitFailed","submitSucceeded","touched","valid","validating","values","visited"],f=["touched","visited"],z=function(e,t,i,r){var n={};return u(n,e,t,i,l,f)||!t||r?n:void 0},_=function(r){var n,a;return function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n&&t.length===n.length&&!t.some(function(e,t){return!L(n[t],e)})||(n=t,a=r.apply(void 0,t)),a}},C=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then},B=function(e,t){return e===t},M=function i(r){return Object.keys(r).some(function(e){var t=r[e];return t&&"object"==typeof t?i(t):void 0!==t})};function D(e,t,i,r,n,a){void 0===a&&(a=!1);var o=n(i,r,t,a);o&&e(o)}function U(e,r,n,a){var o=e.entries;Object.keys(o).forEach(function(e){var t=o[Number(e)],i=t.subscription;D(t.subscriber,i,r,n,a)})}e.createForm=function(e){if(!e)throw new Error("No config specified");e.debug;var o=e.destroyOnUnregister,a=e.keepDirtyOnReinitialize,t=e.initialValues,u=e.mutators,s=e.onSubmit,v=e.validate,l=e.validateOnBlur;if(!s)throw new Error("No onSubmit function specified");var k={subscribers:{index:0,entries:{}},fieldSubscribers:{},fields:{},formState:{dirtySinceLastSubmit:!1,errors:{},initialValues:t&&N({},t),invalid:!1,pristine:!0,submitting:!1,submitFailed:!1,submitSucceeded:!1,valid:!0,validating:0,values:t?N({},t):{}},lastFormState:void 0},r=!1,b=!1,m=!1,S=0,h={},y=function(t){return function(e){return delete h[t],e}},f=function(e,t,i){var r=i(R(e.formState.values,t));e.formState.values=A(e.formState.values,t,r)||{}},d=function(e,t,i){if(e.fields[t]){var r,n;e.fields=N({},e.fields,((r={})[i]=N({},e.fields[t],{name:i,lastFieldState:void 0}),r)),delete e.fields[t],e.fieldSubscribers=N({},e.fieldSubscribers,((n={})[i]=e.fieldSubscribers[t],n)),delete e.fieldSubscribers[t];var a=R(e.formState.values,t);e.formState.values=A(e.formState.values,t,void 0)||{},e.formState.values=A(e.formState.values,i,a),delete e.lastFormState}},i=function(a){return function(){if(u){for(var e={formState:k.formState,fields:k.fields,fieldSubscribers:k.fieldSubscribers,lastFormState:k.lastFormState},t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];var n=u[a](i,e,{changeValue:f,getIn:R,renameField:d,setIn:A,shallowEqual:L});return k.formState=e.formState,k.fields=e.fields,k.fieldSubscribers=e.fieldSubscribers,k.lastFormState=e.lastFormState,c(void 0,function(){p(),j()}),n}}},n=u?Object.keys(u).reduce(function(e,t){return e[t]=i(t),e},{}):{},g=function(r){return Object.keys(r.validators).reduce(function(e,t){var i=r.validators[Number(t)]();return i&&e.push(i),e},[])},c=function(e,t){if(b)return m=!0,void(t&&t());var s=k.fields,i=k.formState,r=Object.keys(s);if(v||r.some(function(e){return g(s[e]).length})){var u=!1;if(e){var n=s[e];if(n){var a=n.validateFields;a&&(u=!0,r=a.length?a.concat(e):[e])}}var l={},f={},o=[].concat(function(e){var t=[];if(v){var i=v(N({},k.formState.values));if(C(i)){var r=S++,n=i.then(e).then(y(r));t.push(n),h[r]=n}else e(i)}return t}(function(e){l=e||{}}),r.reduce(function(e,t){return e.concat((n=s[t],a=function(e){f[t]=e},u=[],(i=g(n)).length&&(i.forEach(function(e){var t=e(R(k.formState.values,n.name),k.formState.values,3===e.length?P(k.formState,k.fields[n.name]):void 0);if(t&&C(t)){var i=S++,r=t.then(a).then(y(i));u.push(r),h[i]=r}else o||(o=t)}),a(o)),u));var n,a,o,u,i},[])),d=function(){var o=N({},u?i.errors:{},l),e=function(a){r.forEach(function(e){if(s[e]){var t=R(l,e),i=R(o,e),r=g(s[e]).length,n=f[e];a(e,r&&n||v&&t||(t||u?void 0:i))}})};e(function(e,t){o=A(o,e,t)||{}}),e(function(e,t){if(t&&t[I]){var i=R(o,e),r=[].concat(i);r[I]=t[I],o=A(o,e,r)}}),L(i.errors,o)||(i.errors=o),i.error=l[x]};if(d(),o.length){k.formState.validating++,t&&t();var c=function(){k.formState.validating--,d(),t&&t()};Promise.all(o).then(c,c)}else t&&t()}else t&&t()},p=function(e){if(!r&&!b){var n=k.fields,a=k.fieldSubscribers,o=k.formState;Object.keys(n).forEach(function(e){var t=n[e],i=P(o,t),r=t.lastFieldState;L(i,r)||(t.lastFieldState=i,U(a[e],i,r,q))})}},E=function(){Object.keys(k.fields).forEach(function(e){k.fields[e].touched=!0})},F=function(){var i=k.fields,r=k.formState,e=k.lastFormState,t=Object.keys(i),n=!1,a=t.reduce(function(e,t){return!i[t].isEqual(R(r.values,t),R(r.initialValues||{},t))&&(n=!0,e[t]=!0),e},{});r.pristine=!n,r.dirtySinceLastSubmit=!(!r.lastSubmittedValues||t.every(function(e){var t=r.lastSubmittedValues||{};return i[e].isEqual(R(r.values,e),R(t,e))})),r.valid=!(r.error||r.submitError||M(r.errors)||r.submitErrors&&M(r.submitErrors));var o,u,s,l,f,d,c,v,b,m,S,h,y,g,p,E=(u=(o=r).active,s=o.dirtySinceLastSubmit,l=o.error,f=o.errors,d=o.initialValues,c=o.pristine,v=o.submitting,b=o.submitFailed,m=o.submitSucceeded,S=o.submitError,h=o.submitErrors,y=o.valid,g=o.validating,p=o.values,{active:u,dirty:!c,dirtySinceLastSubmit:s,error:l,errors:f,hasSubmitErrors:!!(S||h&&M(h)),hasValidationErrors:!(!l&&!M(f)),invalid:!y,initialValues:d,pristine:c,submitting:v,submitFailed:b,submitSucceeded:m,submitError:S,submitErrors:h,valid:y,validating:0<g,values:p}),F=t.reduce(function(e,t){return e.modified[t]=i[t].modified,e.touched[t]=i[t].touched,e.visited[t]=i[t].visited,e},{modified:{},touched:{},visited:{}}),O=F.modified,w=F.touched,j=F.visited;return E.dirtyFields=e&&L(e.dirtyFields,a)?e.dirtyFields:a,E.modified=e&&L(e.modified,O)?e.modified:O,E.touched=e&&L(e.touched,w)?e.touched:w,E.visited=e&&L(e.visited,j)?e.visited:j,e&&L(e,E)?e:E},O=!1,w=!1,j=function e(){if(O)w=!0;else{if(O=!0,!r&&!b){var t=k.lastFormState,i=F();i!==t&&(k.lastFormState=i,U(k.subscribers,i,t,z))}O=!1,w&&(w=!1,e())}};c();var V={batch:function(e){r=!0,e(),r=!1,p(),j()},blur:function(e){var t=k.fields,i=k.formState,r=t[e];r&&(delete i.active,t[e]=N({},r,{active:!1,touched:!0}),l?c(e,function(){p(),j()}):(p(),j()))},change:function(e,t){var i=k.fields,r=k.formState;if(R(r.values,e)!==t){f(k,e,function(){return t});var n=i[e];n&&(i[e]=N({},n,{modified:!0})),l?(p(),j()):c(e,function(){p(),j()})}},focus:function(e){var t=k.fields[e];t&&!t.active&&(k.formState.active=e,t.active=!0,t.visited=!0,p(),j())},mutators:n,getFieldState:function(e){var t=k.fields[e];return t&&t.lastFieldState},getRegisteredFields:function(){return Object.keys(k.fields)},getState:function(){return F()},initialize:function(e){var i=k.fields,r=k.formState,n="function"==typeof e?e(r.values):e;a||(r.values=n),Object.keys(i).forEach(function(e){var t=i[e];t.modified=!1,t.touched=!1,t.visited=!1,a&&i[e].isEqual(R(r.values,e),R(r.initialValues||{},e))&&(r.values=A(r.values,e,R(n,e)))}),r.initialValues=n,c(void 0,function(){p(),j()})},isValidationPaused:function(){return b},pauseValidation:function(){b=!0},registerField:function(t,i,r,e){void 0===r&&(r={}),k.fieldSubscribers[t]||(k.fieldSubscribers[t]={index:0,entries:{}});var n=k.fieldSubscribers[t].index++;k.fieldSubscribers[t].entries[n]={subscriber:_(i),subscription:r},k.fields[t]||(k.fields[t]={active:!1,blur:function(){return V.blur(t)},change:function(e){return V.change(t,e)},data:{},focus:function(){return V.focus(t)},isEqual:e&&e.isEqual||B,lastFieldState:void 0,modified:!1,name:t,touched:!1,valid:!0,validateFields:e&&e.validateFields,validators:{},visited:!1}),e&&(e.getValidator&&(k.fields[t].validators[n]=e.getValidator),void 0!==e.initialValue&&(k.formState.initialValues=A(k.formState.initialValues||{},t,e.initialValue),k.formState.values=A(k.formState.values,t,e.initialValue)),void 0!==e.defaultValue&&(k.formState.values=A(k.formState.values,t,e.defaultValue)));var a=!1;return c(void 0,function(){var e;j(),a||(e=P(k.formState,k.fields[t]),D(i,r,e,void 0,q,!0),k.fields[t].lastFieldState=e,a=!0),p()}),function(){delete k.fields[t].validators[n],delete k.fieldSubscribers[t].entries[n],Object.keys(k.fieldSubscribers[t].entries).length||(delete k.fieldSubscribers[t],delete k.fields[t],k.formState.errors=A(k.formState.errors,t,void 0)||{},o&&(k.formState.values=A(k.formState.values,t,void 0,!0)||{})),c(void 0,function(){p(),j()})}},reset:function(e){void 0===e&&(e=k.formState.initialValues),k.formState.submitFailed=!1,k.formState.submitSucceeded=!1,delete k.formState.submitError,delete k.formState.submitErrors,delete k.formState.lastSubmittedValues,V.initialize(e||{})},resumeValidation:function(){b=!1,m&&c(void 0,function(){p(),j()}),m=!1},setConfig:function(e,t){switch(e){case"debug":break;case"destroyOnUnregister":o=t;break;case"initialValues":V.initialize(t);break;case"keepDirtyOnReinitialize":a=t;break;case"mutators":(u=t)?(Object.keys(n).forEach(function(e){e in t||delete n[e]}),Object.keys(t).forEach(function(e){n[e]=i(e)})):Object.keys(n).forEach(function(e){delete n[e]});break;case"onSubmit":s=t;break;case"validate":v=t,c(void 0,function(){p(),j()});break;case"validateOnBlur":l=t;break;default:throw new Error("Unrecognised option "+e)}},submit:function(){var t=k.formState;if(k.formState.error||M(k.formState.errors))return E(),k.formState.submitFailed=!0,j(),void p();var e=Object.keys(h);if(e.length)Promise.all(e.reduce(function(e,t){return e.push(h[Number(t)]),e},[])).then(V.submit,V.submit);else{var i,r=!1,n=function(e){return t.submitting=!1,e&&M(e)?(t.submitFailed=!0,t.submitSucceeded=!1,t.submitErrors=e,t.submitError=e[x],E()):(delete t.submitErrors,delete t.submitError,t.submitFailed=!1,t.submitSucceeded=!0),j(),p(),r=!0,i&&i(e),e};t.submitting=!0,t.submitFailed=!1,t.submitSucceeded=!1,t.lastSubmittedValues=N({},t.values);var a=s(t.values,V,n);if(!r){if(a&&C(a))return j(),p(),a.then(n,function(e){throw n(),e});if(3<=s.length)return j(),p(),new Promise(function(e){i=e});n(a)}}},subscribe:function(e,t){if(!e)throw new Error("No callback given.");if(!t)throw new Error("No subscription provided. What values do you want to listen to?");var i=_(e),r=k.subscribers,n=k.lastFormState,a=r.index++;r.entries[a]={subscriber:i,subscription:t};var o=F();return o!==n&&(k.lastFormState=o),D(i,t,o,o,z,!0),function(){delete r.entries[a]}}};return V},e.configOptions=["debug","initialValues","keepDirtyOnReinitialize","mutators","onSubmit","validate","validateOnBlur"],e.version="4.8.1",e.ARRAY_ERROR=I,e.FORM_ERROR=x,e.formSubscriptionItems=l,e.fieldSubscriptionItems=a,e.getIn=R,e.setIn=A,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=final-form.umd.min.js.map
